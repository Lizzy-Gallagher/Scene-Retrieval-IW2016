#!/bin/bash

# run from projects
data_dir="../.."
name=$(basename $PWD)

py_dir="../../../rel-proj/"
analyze_loc="$py_dir/py/analyze.py"

meas="$data_dir/measurements/$name.txt"
rel="$data_dir/relationships/$name.arff"


# Handle command-line args:
# clean
# clean rel
# clean meas
if [[ $# != 0 ]]; then
    if [[ $1 = "clean" ]]; then 
        if [[ $# > 1 ]]; then 
            if [[ $2 = "meas" ]]; then
                echo "rm $meas"
                rm $meas
            elif [[ $2 = "rel" ]]; then
                echo "rm $rel"
                rm $rel
            else
                echo "Did not recognize cmd: " $2
                exit
            fi
        else
            echo "rm $meas"
            rm $meas
            echo "rm $rel"
            rm $rel
        fi
    fi
fi

# If no measurements for the scene, measure
# call it measurements/#.txt
echo
echo
echo "Checking if measurements exist..."
if [ ! -f $meas ]; then
    echo -e "\tNo measurements found."
    echo -e "\tMeasuring..."
    scn2meas project.json $meas
else
    echo -e "\tMeasurements found!"
fi

echo
echo

# If no relationships for the scene, calculate relationships
# call it relationship/#.csv

echo "Checking if relationships exist..."
if [ ! -f $rel ]; then
    meas2="data/measurements/$name.txt"
    rel2="data/relationships/$name.arff"
    
    echo -e "\tNo relationships found."
    echo -e "\tAnalyzing..."
    $(cd $py_dir; python py/analyze.py -mode mlcat $meas2 $rel2 > output.txt)
else
    echo -e "\tRelationships found!"
fi

echo
echo

echo "Check out " $rel " for the data" 

